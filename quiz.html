<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Quiz</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/quiz.css">
</head>

<body>

  <!-- =====================================================
       HEADER QUIZ
  ===================================================== -->
  <header class="quiz-header">
    <h1 id="quiz-judul">Judul Pertemuan</h1>

    <div id="progress-wrapper">
      <div id="progress-bar"><div></div></div>
      <span id="progress-text">1/10</span>
    </div>
  </header>

  <!-- =====================================================
       AREA SOAL
  ===================================================== -->
  <main id="quiz-container">

    <section id="soal-utama">
      <p id="soal-instruksi">Instruksi soal muncul di sini</p>

      <button id="btn-audio-soal" class="audio-btn">
        ▶️ Putar Audio Soal
      </button>

      <p id="soal-kalimat"></p>
    </section>

    <!-- OPSI -->
    <section id="opsi-jawaban"></section>

    <!-- PERIKSA -->
    <div class="periksa-wrapper">
      <button id="btn-periksa" disabled>Periksa</button>
    </div>

  </main>


  <!-- =====================================================
       GLOBAL NAV
  ===================================================== -->
  <nav class="bottom-nav">

    <a href="tema.html" class="nav-item" id="nav-tema">
      <svg viewBox="0 0 24 24"><path d="M3 10.5L12 3l9 7.5V21H3z"/></svg>
      <span>Tema</span>
    </a>

    <a href="#" class="nav-item" id="nav-subtema">
      <svg viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
      <span>Subtema</span>
    </a>

    <a href="#" class="nav-item" id="nav-pertemuan">
      <svg viewBox="0 0 24 24"><path d="M4 19V5a1 1 0 0 1 1-1h11v16H4z"/></svg>
      <span>Pertemuan</span>
    </a>

    <a href="profil.html" class="nav-item" id="nav-profil">
      <svg viewBox="0 0 24 24"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm7 9c0-4-3-6-7-6s-7 2-7 6"/></svg>
      <span>Profil</span>
    </a>

  </nav>


  <!-- =====================================================
       GLOBAL NAV SCRIPT
  ===================================================== -->
  <script>
    const page = window.location.pathname.split("/").pop();
    const params = new URLSearchParams(window.location.search);

    const temaId = params.get("tema");
    const subtemaId = params.get("subtema");

    // Set link dinamis
    if (temaId)
      document.getElementById("nav-subtema").href =
        `subtema.html?tema=${temaId}`;

    if (temaId && subtemaId)
      document.getElementById("nav-pertemuan").href =
        `pertemuan.html?tema=${temaId}&subtema=${subtemaId}`;

    // Active state
    if (page.includes("quiz"))
      document.getElementById("nav-pertemuan").classList.add("active");
  </script>


  <!-- =====================================================
       SCRIPT QUIZ
  ===================================================== -->
  <script type="module" src="js/pages/quiz.js"></script>

  <!-- RESULT MODAL (Duolingo Style) -->
  <div id="result-modal" class="modal hidden">
    <div class="modal-overlay"></div>

    <div class="modal-card">
      <div class="result-stars">
        ★ ★ ★
      </div>

      <h2 id="result-score" class="result-score">0%</h2>
      <p id="result-message" class="result-message">Hasil kamu bagus!</p>

      <div class="modal-actions">
        <button id="btn-lanjut" class="modal-btn modal-btn-green">Lanjut Pertemuan</button>
        <button id="btn-ulangi" class="modal-btn modal-btn-yellow">Ulangi Quiz</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const modal = document.getElementById("result-modal");
  const scoreEl = document.getElementById("result-score");
  const msgEl = document.getElementById("result-message");
  const btnUlangi = document.getElementById("btn-ulangi");
  const btnLanjut = document.getElementById("btn-lanjut");

  // TERIMA DATA DARI quiz.js VIA EVENTS
  window.showQuizResult = function(data) {
    modal.classList.remove("hidden");

    scoreEl.textContent = data.skor + "%";

    if (data.skor === 100) msgEl.textContent = "Sempurna! Kamu luar biasa!";
    else if (data.skor >= 70) msgEl.textContent = "Bagus! Kamu hampir sempurna!";
    else msgEl.textContent = "Tetap semangat, coba lagi ya!";

    // Putar suara selesai
    const selesaiAudio = new Audio("assets/audio/backsound/Selesai.mp3");
    selesaiAudio.play().catch(()=>{});
  };

  btnUlangi.onclick = () => {
    window.location.reload();
  };

  btnLanjut.onclick = () => {
    const params = new URLSearchParams(window.location.search);
    const tema = params.get("tema");
    const subtema = params.get("subtema");
    window.location.href = `pertemuan.html?tema=${tema}&subtema=${subtema}`;
  };

});
</script>

</body>
</html>